<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Event Recorder Dashboard</title>
    <link href="{{ url_for('static', filename='css/event_recorder.css') }}" rel="stylesheet">
</head>
<body>
<div class="control-buttons">
    <button class="control-btn record-btn" id="record-btn" onclick="showRecordInfo()" title="Start Recording (requires ServiceBus connection)">
        ‚è∫Ô∏è
    </button>
    <button class="control-btn" id="dark-mode-btn" onclick="toggleDarkMode()" title="Toggle Dark Mode (D)">
        üåô
    </button>
    <button class="control-btn" id="info-btn" onclick="showInfo()" title="Info & Help">
        ‚ÑπÔ∏è
    </button>
</div>

<div class="container">
    <div class="header">
        <h1>üé¨ Event Recorder Dashboard</h1>
        <p>View and replay event recordings</p>
    </div>

    <div class="navbar">
        <a class="nav-link" href="http://localhost:5555">Event Flow</a>
        <a class="nav-link active" href="http://localhost:5556">Recorder</a>
        <a class="nav-link" href="http://localhost:5557">Exchange</a>
        <a class="nav-link" href="http://localhost:5558">Testing</a>
    </div>

    <div class="content">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{ total_recordings }}</div>
                <div class="stat-label">Recordings</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ total_events }}</div>
                <div class="stat-label">Total Events</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ total_duration }}</div>
                <div class="stat-label">Total Duration</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ avg_events_per_recording }}</div>
                <div class="stat-label">Avg Events/Recording</div>
            </div>
        </div>

        {% if recordings %}
        <div class="recordings-list">
            {% for recording in recordings %}
            <div class="recording-card" onclick="viewRecording('{{ recording.filename }}')">
                <div class="recording-header">
                    <div class="recording-name">{{ recording.session_name }}</div>
                    <div class="recording-date">{{ recording.created_at }}</div>
                </div>
                <div class="recording-stats">
                    <div class="recording-stat">
                        <span class="icon">‚è±</span>
                        <span>{{ recording.duration }}</span>
                    </div>
                    <div class="recording-stat">
                        <span class="icon">üìä</span>
                        <span>{{ recording.event_count }} events</span>
                    </div>
                    <div class="recording-stat">
                        <span class="icon">üè∑</span>
                        <span>{{ recording.unique_events }} types</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">üé¨</div>
            <div class="empty-state-text">No recordings found</div>
            <div class="empty-state-hint">
                Start recording with EventRecorder to see recordings here
            </div>
        </div>
        {% endif %}
    </div>

    <div class="footer">
        <p>üé¨ Event Recorder Dashboard | Port 5556 | <kbd>Ctrl+R</kbd> to refresh</p>
    </div>
</div>

<button class="refresh-btn" onclick="location.reload()" title="Refresh">
    ‚Üª
</button>

<!-- Recording Modal -->
<div class="modal" id="recording-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>‚è∫Ô∏è Start Recording</h2>
            <span class="close-btn" onclick="closeRecordingModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p>Start a new recording session to capture events from your application.</p>
            <div class="form-group">
                <label for="session-name">Session Name:</label>
                <input type="text" id="session-name" placeholder="e.g., trading_session_001"
                       value="session_{{ now.strftime('%Y%m%d_%H%M%S') if now else '' }}">
            </div>
            <div class="modal-info">
                <p><strong>üìù Note:</strong> Make sure your application ServiceBus is running with <code>enable_recording=True</code></p>
                <p><strong>üîó Or</strong> the application will send events manually to this endpoint</p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeRecordingModal()">Cancel</button>
            <button class="btn-primary" onclick="startRecording()">Start Recording</button>
        </div>
    </div>
</div>

<!-- Recording Status Bar (hidden by default) -->
<div class="recording-status-bar" id="recording-status-bar" style="display: none;">
    <div class="recording-status-content">
        <span class="recording-pulse">‚è∫Ô∏è</span>
        <span class="recording-session-name" id="recording-session-name">Recording...</span>
        <span class="recording-event-count" id="recording-event-count">0 events</span>
    </div>
    <button class="stop-recording-btn" onclick="stopRecording()">‚èπ Stop</button>
</div>

<script src="{{ url_for('static', filename='js/event_recorder.js') }}"></script>
</body>
</html>
